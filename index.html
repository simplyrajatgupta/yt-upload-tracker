<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Upload Manager (GitHub Token Connect)</title>
<style>
  body{margin:0;font-family:sans-serif;background:#0a0e13;color:#fff;}
  .appbar{padding:1rem;background:#121821;display:flex;gap:.5rem;align-items:center;}
  .search{flex:1;display:flex;gap:.5rem;}
  .search input{flex:1;padding:.5rem;border-radius:6px;border:none;}
  .list{padding:1rem;display:grid;gap:.5rem;}
  .item{padding:.5rem;border:1px solid #333;border-radius:8px;background:#1a1f2e;display:flex;justify-content:space-between;align-items:center;}
  .fab{position:fixed;bottom:70px;right:20px;width:60px;height:60px;border-radius:50%;background:#2d7dff;color:#fff;font-size:30px;display:grid;place-items:center;cursor:pointer;}
  .dialog-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;place-items:center;}
  .dialog{background:#121821;padding:1rem;border-radius:10px;max-width:320px;width:90%;}
  .dialog input{width:100%;padding:.5rem;margin:.3rem 0;border-radius:6px;border:none;}
  .btn{padding:.5rem 1rem;border:none;border-radius:6px;cursor:pointer;margin:.2rem;}
  .btn.primary{background:#2d7dff;color:#fff;}
  .btn.ghost{background:#333;color:#fff;}
  .footer{position:fixed;bottom:0;left:0;right:0;padding:.7rem;background:#121821;display:flex;gap:.5rem;align-items:center;}
  .footer input{flex:1;padding:.5rem;border-radius:6px;border:none;}
  .status{font-size:.9rem;margin-left:.5rem;}
  .status.ok{color:#4ade80;} /* green */
  .status.err{color:#f87171;} /* red */
</style>
</head>
<body>

<div class="appbar">
  <div class="search">
    <input id="searchInput" placeholder="Search">
  </div>
  <button id="loadBtn" class="btn ghost">Load</button>
  <button id="saveBtn" class="btn primary">Save</button>
</div>

<div class="list" id="list"></div>
<div class="fab" id="addFab">+</div>

<div class="dialog-backdrop" id="dialogBackdrop">
  <div class="dialog">
    <h3 id="dialogTitle">Add Upload</h3>
    <input id="titleInput" placeholder="Title">
    <input id="dateInput" type="date">
    <div style="text-align:right">
      <button class="btn ghost" id="cancelBtn">Cancel</button>
      <button class="btn primary" id="saveDialogBtn">Save</button>
    </div>
  </div>
</div>

<div class="footer">
  <input id="tokenInput" placeholder="Paste GitHub Token">
  <button id="connectBtn" class="btn primary">Connect</button>
  <span id="statusMsg" class="status"></span>
</div>

<script>
// --- Fixed repo info ---
const OWNER = "simplyrajatgupta";
const REPO = "yt-upload-tracker";
const BRANCH = "main";
const PATH = "data.json";

let TOKEN = null;
let items = [];
let editingId = null;
let state = {sha:null};

// Helpers
function headers(){return {"Accept":"application/vnd.github+json","Authorization":"token "+TOKEN};}
function uid(){return Math.random().toString(36).slice(2,10)+Date.now().toString(36);}
function today(){return new Date().toISOString().slice(0,10);}

async function testToken(){
  const url=`https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}?ref=${BRANCH}`;
  try{
    const r=await fetch(url,{headers:headers()});
    if(!r.ok){throw new Error("Bad response");}
    const j=await r.json(); state.sha=j.sha;
    const txt=atob(j.content.replace(/\n/g,""));
    const data=JSON.parse(txt);
    items=data.uploads||[];
    render();
    setStatus("✅ Connected","ok");
  }catch(e){
    setStatus("❌ Invalid token","err");
  }
}

async function loadData(){
  if(!TOKEN){alert("Enter token first");return;}
  const url=`https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}?ref=${BRANCH}`;
  const r=await fetch(url,{headers:headers()});
  if(!r.ok){alert("Load failed");return;}
  const j=await r.json(); state.sha=j.sha;
  const txt=atob(j.content.replace(/\n/g,""));
  const data=JSON.parse(txt);
  items=data.uploads||[];
  render();
}

async function saveData(){
  if(!TOKEN){alert("Enter token first");return;}
  const body={message:"Update uploads",content:btoa(JSON.stringify({uploads:items},null,2)),sha:state.sha,branch:BRANCH};
  const url=`https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}`;
  const r=await fetch(url,{method:"PUT",headers:{...headers(),"Content-Type":"application/json"},body:JSON.stringify(body)});
  if(!r.ok){alert("Save failed");return;}
  const j=await r.json(); state.sha=j.content.sha; alert("Saved!");
}

function render(){
  const q=document.getElementById("searchInput").value.toLowerCase();
  const list=document.getElementById("list");
  list.innerHTML="";
  items.filter(it=>!q||it.title.toLowerCase().includes(q)).forEach(it=>{
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`<span>${it.title} (${it.date})</span>
      <div>
        <button class="btn ghost" onclick="editItem('${it.id}')">Edit</button>
        <button class="btn ghost" onclick="delItem('${it.id}')">Del</button>
      </div>`;
    list.appendChild(div);
  });
}

function editItem(id){
  const it=items.find(x=>x.id===id);
  if(!it)return;
  editingId=id;
  document.getElementById("dialogTitle").textContent="Edit Upload";
  document.getElementById("titleInput").value=it.title;
  document.getElementById("dateInput").value=it.date;
  backdrop.style.display="grid";
}
function delItem(id){items=items.filter(x=>x.id!==id);render();}

// Dialog
const backdrop=document.getElementById("dialogBackdrop");
document.getElementById("addFab").onclick=()=>{editingId=null;document.getElementById("titleInput").value="";document.getElementById("dateInput").value=today();backdrop.style.display="grid";};
document.getElementById("cancelBtn").onclick=()=>backdrop.style.display="none";
document.getElementById("saveDialogBtn").onclick=()=>{
  const title=document.getElementById("titleInput").value.trim();
  const date=document.getElementById("dateInput").value||today();
  if(!title)return alert("Enter title");
  if(editingId){let it=items.find(x=>x.id===editingId);if(it){it.title=title;it.date=date;}}
  else{items.push({id:uid(),title,date});}
  backdrop.style.display="none";render();
};

// Status display
function setStatus(msg,cls){const s=document.getElementById("statusMsg");s.textContent=msg;s.className="status "+cls;}

// Hooks
document.getElementById("searchInput").oninput=render;
document.getElementById("loadBtn").onclick=loadData;
document.getElementById("saveBtn").onclick=saveData;
document.getElementById("connectBtn").onclick=()=>{TOKEN=document.getElementById("tokenInput").value.trim();testToken();};
</script>
</body>
</html>